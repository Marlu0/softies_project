<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Chat - Softy</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='chat.css') }}">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <a href="/" class="projects-button">
                <span class="back-arrow">‚Üê</span>
                <span class="projects-text">Projects</span>
            </a>
            <ul>
                {% for project in projects %}
                    <li class="{% if project.name == project_name %}active{% endif %}">
                        <a href="{{ url_for('chat_project', project_name=project.name) }}">{{ project.name }}</a>
                    </li>
                {% endfor %}
            </ul>
            <div class="settings">‚öôÔ∏è Settings</div>
        </aside>

        <main class="chat-area">
            <header class="chat-header">
                <h1>ü§ñ Softy</h1>
            </header>

            <section class="messages">
                {% for msg in messages %}
                    <div class="message {{ msg['sender'] }}">{{ msg['text'] }}</div>
                {% endfor %}
            </section>

            <footer class="chat-input">
                <input type="text" placeholder="Enter your message">
            </footer>
        </main>
    </div>

    <script>
    document.addEventListener("DOMContentLoaded", () => {
        const input = document.querySelector(".chat-input input");
        const messagesContainer = document.querySelector(".messages");
        const projectName = "{{ project_name }}";

        input.addEventListener("keypress", function(e) {
            if (e.key === "Enter" && input.value.trim() !== "") {
                const text = input.value;
                input.value = "";

                // Mostrar mensaje del usuario
                const userMessage = document.createElement("div");
                userMessage.className = "message user";
                userMessage.textContent = text;
                messagesContainer.appendChild(userMessage);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                // Enviar al backend
                fetch(`/chat/${projectName}/send`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ text })
                })
                .then(response => response.json())
                .then(data => {
                    const botMessage = document.createElement("div");
                    botMessage.className = "message bot";
                    botMessage.textContent = data.response;
                    messagesContainer.appendChild(botMessage);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                })
                .catch(err => {
                    console.error("Error al enviar mensaje:", err);
                });
            }
        });
    });
    </script>

</body>
</html>
